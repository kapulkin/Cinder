
<div class="textblock"><h2>Introduction</h2>
<p>Cinder makes writing QuickTime movies a straightforward task via the <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html">qtime::MovieWriter</a> class. Creating a basic QuickTime movie is easy, and <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html">qtime::MovieWriter</a> also exposes more advanced options which allow you to take full advantage of the features of modern codecs like <a href="http://en.wikipedia.org/wiki/H.264/MPEG-4_AVC">H.264</a>. <br />
 </p><h2>Creating a Simple Movie</h2>
<p>To setup an instance of <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html">qtime::MovieWriter</a>, we'll need to know two things: the path where we'd like to create the movie, and its dimensions in pixels. As an example, we'll imagine we'd like to create a movie called <em>myMovie.mov</em> and we'd like it saved into our user documents directory. We'll also assume the movie is 640x480 pixels.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_movie_writer_8h.html">cinder/qtime/MovieWriter.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_utilities_8h.html">cinder/Utilities.h</a>&quot;</span></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacecinder.html">ci</a>;</div>
<div class="line"></div>
<div class="line">qtime::MovieWriter movie( <a class="code" href="namespacecinder.html#aa4e3c9b5bd9041dc72842ed5834d67e5">getDocumentsDirectory</a>() + <span class="stringliteral">&quot;myMovie.mov&quot;</span>, 640, 480 );</div>
</div><!-- fragment --><p> <br />
 Because we have not specified any additional parameters, the <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html">qtime::MovieWriter</a> defaults to using a PNG codec, and will run at 30 frames per second. Now let's imagine we have a rendering loop which will create an animation 100 frames long. We'll assume we have a routine called <code>renderFrame()</code> which has a parameter for providing which frame we need, and it returns a <a class="el" href="classcinder_1_1_surface_t.html">Surface</a>. Continuing where we left off, here's how we might put the <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html">qtime::MovieWriter</a> to use: </p><div class="fragment"><div class="line"><a class="code" href="namespacecinder.html#a7f62055e4cb811edb9868b32595a1d64">Surface</a> renderFrame( <span class="keywordtype">int</span> frame ); <span class="comment">// defined elsewhere</span></div>
<div class="line"></div>
<div class="line"><span class="keywordflow">for</span>( <span class="keywordtype">int</span> frame = 0; frame &lt; 100; ++frame ) {</div>
<div class="line">  movie.addFrame( renderFrame( frame ) );</div>
<div class="line">}</div>
</div><!-- fragment --><p> <br />
 For the basic use case, that's all there is to it - we simply call addFrame() with our Surface inside the loop. When the <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html">qtime::MovieWriter</a> goes out of scope, it will save all its frames to disk. Alternatively, to explicitly force the <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html">qtime::MovieWriter</a> to save, call finish(): </p><div class="fragment"><div class="line">movie.finish();</div>
</div><!-- fragment --><p> <br />
 </p><h2>Specifying Formats</h2>
<p>The <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html">qtime::MovieWriter</a> class offers extensive options for customizing the format of its output, and this can be done using the <a class="el" href="classcinder_1_1qtime_1_1_movie_writer_1_1_format.html">qtime::MovieWriter::Format</a> class. Here's an example of how to modify the codec to be <code>JPEG</code> and the quality to 50%: </p><div class="fragment"><div class="line">qtime::MovieWriter::Format format;</div>
<div class="line">format.setCodec( qtime::MovieWriter::CODEC_JPEG );</div>
<div class="line">format.setQuality( 0.5f );</div>
<div class="line">qtime::MovieWriter movie( <a class="code" href="namespacecinder.html#aa4e3c9b5bd9041dc72842ed5834d67e5">getDocumentsDirectory</a>() + <span class="stringliteral">&quot;myMovie.mov&quot;</span>, 640, 480, format );</div>
</div><!-- fragment --><p> <br />
 The first call, setCodec(), allows users to provide a constant from among several defined for popular codecs or the four character identifier as specified by QuickTime in its header file <code>ImageCompression.h</code>. The second call, setQuality() allows the specification of a level of quality ranging from the lowest, <code>0.0</code> to the highest, <code>1.0</code> (which for some codecs is lossless). The <a class="el" href="classcinder_1_1qtime_1_1_movie_writer_1_1_format.html">qtime::MovieWriter::Format</a> class also allows the chaining of several calls as a convenience, which looks like this: </p><div class="fragment"><div class="line">qtime::MovieWriter movie( <a class="code" href="namespacecinder.html#aa4e3c9b5bd9041dc72842ed5834d67e5">getDocumentsDirectory</a>() + <span class="stringliteral">&quot;myMovie.mov&quot;</span>,</div>
<div class="line">              640, 480, qtime::MovieWriter::Format().setCodec( <span class="stringliteral">&#39;png &#39;</span> ).setQuality( 0.95f ) );</div>
</div><!-- fragment --><p> <br />
 </p><h2>MultiPass Encoding</h2>
<p>The documentation for <a class="el" href="classcinder_1_1qtime_1_1_movie_writer_1_1_format.html">qtime::MovieWriter::Format</a> provides a more thorough list of its options, but a key principle is that the default settings will achieve the best possible quality with one exception: multiPass encoding is not enabled by default. This is a technique which allows QuickTime to make several passes over the frames' data, and can result in much higher quality output. At the time of this writing, only the H.264 codec can make use of the technique. However this is not enabled by default because it can result in a lengthy postprocessing phase, and it requires the creation of two temporary files. The first of these files QuickTime creates for its own purposes, and the second <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html">qtime::MovieWriter</a> makes to store temporary copies of all frames supplied by calls to addFrame(). However all of this is handled automatically when multiPass encoding is enabled via qtime::MovieWriter::Format::enableMultiPass(). <br />
 </p><h2>User Compression Options</h2>
<p>QuickTime provides a standard user interface for specifying encoding options, and Cinder makes this available via the qtime::MovieWriter::getUserCompressionSettings function. This function can be used to populate a <a class="el" href="classcinder_1_1qtime_1_1_movie_writer_1_1_format.html">qtime::MovieWriter::Format</a> instance. Also note that the resulting instance may contain additional settings that <a class="el" href="classcinder_1_1qtime_1_1_movie_writer_1_1_format.html">qtime::MovieWriter::Format</a> does not provide direct functions for manipulating. An optional parameter allows the specification of a preview image for the dialog. </p><div class="fragment"><div class="line"><a class="code" href="namespacecinder.html#a7f62055e4cb811edb9868b32595a1d64">Surface</a> previewImage( <a class="code" href="namespacecinder.html#ad49aa427548e365f95336af782c2161a">loadImage</a>( <a class="code" href="namespacecinder_1_1app.html#a93522b1858f745f7d9438d6d124ae11b">loadResource</a>( RES_PREVIEW_IMAGE ) ) );</div>
<div class="line">qtime::MovieWriter::Format format;</div>
<div class="line"><span class="keywordflow">if</span>( qtime::MovieWriter::getUserCompressionSettings( &amp;format, previewImage ) ) {</div>
<div class="line">  mMovieWriter = qtime::MovieWriter( path, <a class="code" href="namespacecinder_1_1app.html#ac8c6ecaf9d91c5eedfd6b127a60e939d">getWindowWidth</a>(), <a class="code" href="namespacecinder_1_1app.html#a71d6248e05c9a15ad660a5243da38a70">getWindowHeight</a>(), format );</div>
<div class="line">}</div>
</div><!-- fragment --><p> <br />
 </p><div class="image">
<img src="images/qtime_settings.png" alt="qtime_settings.png"/>
</div>
<p> <br />
 </p><h2>Issues</h2>
<p>There are a couple of known issues we're still looking into in the <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html">qtime::MovieWriter</a> class. The first is that there is a visible gamma shift (things get brighter and desaturated) with certain codecs, including H.264. This seems to be a pervasive problem with QuickTime, and one which video encoding even with Apple's own QuickTime Player suffers from. There are numerous discussions of the issue on the internet, and we have yet to find a solution, unfortunately. <br />
<br />
 Also currently <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html">qtime::MovieWriter</a> does not support audio exporting, and this will be introduced in future revisions. </p>
</div>